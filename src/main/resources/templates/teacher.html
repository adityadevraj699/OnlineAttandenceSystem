<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ERP Attendance System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body style="background: linear-gradient(to right, #cce0ff, #e6f0ff); min-height:100vh; display:flex; flex-direction:column;">

  <!-- Header -->
  <header class="text-center text-dark py-4" style="background-color:rgba(255,255,255,0.6); border-bottom:1px solid #ddd;">
    <h1 style="font-weight:700; letter-spacing:1px;">ERP Attendance System</h1>
    <p style="font-size:1.1rem; opacity:0.8;">Teacher Dashboard</p>
  </header>

  <!-- Main Content -->
  <main class="flex-grow-1 container py-5">

    <!-- Date Picker Form -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-6 text-center">
        <form action="/teacher/attendance" method="get" class="d-flex justify-content-center align-items-center gap-2">
          <input type="date" name="date" th:value="${selectedDate}" 
                 class="form-control form-control-lg" style="max-width:200px;" required>
          <button type="submit" class="btn btn-success btn-lg"
                  style="border-radius:50px; font-weight:600; background:linear-gradient(90deg,#2ecc71,#58d68d); border:none;">
            Check Attendance
          </button>
        </form>
      </div>
    </div>

    <!-- Attendance Table Card -->
    <div th:if="${attendanceData != null}" class="card shadow-sm p-4" style="border-radius:15px; background-color:#ffffffcc;">

      <!-- Summary Bar -->
      <div class="d-flex justify-content-around mb-3 p-2" style="background-color:#f0f8ff; border-radius:10px; font-weight:600;">
        <div>Total Students: <span id="totalStudents">0</span></div>
        <div>Total Present: <span id="totalPresent" class="text-success">0</span></div>
        <div>Total Absent: <span id="totalAbsent" class="text-danger">0</span></div>
      </div>

      <!-- Filter Dropdown with Clear Button -->
<div class="d-flex justify-content-center mb-3 align-items-center gap-2">
  <select class="form-select w-auto" id="statusFilter" onchange="filterTable(this.value)">
    <option value="All" selected>All</option>
    <option value="Present">Present</option>
    <option value="Absent">Absent</option>
  </select>
  <button class="btn btn-secondary" onclick="clearFilter()" style="height:38px;">Clear</button>
</div>


      <h5 class="mb-3 text-primary text-center" th:text="'Attendance for: ' + ${selectedDate}"></h5>

      <div class="table-responsive">
        <table class="table table-bordered text-center" id="attendanceTable" style="border-radius:10px; overflow:hidden;">
          <thead class="table-light" style="background: linear-gradient(90deg,#4a90e2,#50c0e9); color:white;">
            <tr>
              <th>S. No</th>
              <th>Roll No</th>
              <th>Name</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="record : ${attendanceData}" 
                th:classappend="${record.status == 'Present'} ? 'table-success' : 'table-danger'" 
                style="transition: all 0.3s; cursor:pointer;"
                onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.1)';"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
              <td class="sno"></td>
              <td th:text="${record.rollNo}"></td>
              <td th:text="${record.name}"></td>
              <td th:text="${record.status}"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- No data message -->
      <p class="mt-2 text-muted text-center" th:if="${#lists.isEmpty(attendanceData)}">
        No attendance records found for the selected date.
      </p>

    </div>

  </main>

  <!-- Footer -->
  <footer class="text-center text-dark py-3" style="background-color:rgba(255,255,255,0.6); border-top:1px solid #ddd; font-size:0.9rem;">
    Â© 2025 ERP Attendance System
  </footer>

<script>
  const table = document.getElementById('attendanceTable');

  // Function to update S. No, total students, present, absent
  function updateTableStats() {
    const rows = table.querySelectorAll('tbody tr');
    let serial = 1, present = 0, absent = 0, total = 0;

    rows.forEach(row => {
      if(row.style.display !== 'none') {
        row.querySelector('.sno').textContent = serial++;
        total++;
        const status = row.cells[3].textContent;
        if(status === 'Present') present++;
        else if(status === 'Absent') absent++;
      }
    });

    document.getElementById('totalStudents').textContent = total;
    document.getElementById('totalPresent').textContent = present;
    document.getElementById('totalAbsent').textContent = absent;
  }

  // Initial stats
  updateTableStats();

  function filterTable(status) {
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const cell = row.cells[3]; // Status column
      const cellText = cell.textContent || cell.innerText;
      row.style.display = (status === 'All' || cellText === status) ? '' : 'none';
    });
    updateTableStats(); // Update stats after filtering
  }
  
  
  function clearFilter() { window.location.href = '/teacher'; }
</script>

</body>
</html>
